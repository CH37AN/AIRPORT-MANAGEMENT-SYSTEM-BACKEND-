
-- ********************************************************************** AIRPORT MANAGEMENT SYSTEM ********************************************************************
-- ***************************************************************** DBT MINI-PROJECT BY CHETAN AND ANJALI ************************************************************* 

create database Airline_Management_System;
use Airline_Management_System;

create database tempAMS;
use tempAMS;

-- Creating City table --
create table city(
c_name varchar(15) not null,
s_name varchar(15),
country varchar(35),
primary key(c_name));

-- Inserting data in City Table --
insert into city values
('Mumbai','Maharashtra','India'),
('Delhi','Delhi','India'),
('Banglore','Karnataka','India'),
('Hydrabad','Telangane','India'),
('Ahmedabad','Gujrat','India'),
('Amritsar','Punjab','India');

-- Creating Airport Table --
create table Airport(
AP_name varchar(100) not null,
s_name varchar(15),
c_name varchar(15),
primary key(AP_name),
foreign key(c_name) references city(c_name) on delete cascade);

-- Inserting data in Airport table -- 

INSERT INTO AIRPORT (AP_NAME, s_name, c_name) VALUES
('Chhatrapati Shivaji International Airport','Maharashtra','Mumbai'),
('Indira GandhiInternational Airport','Delhi','Delhi'),
('Kempegowda International Airport','Karnataka','Banglore'),
('Rajiv Gandhi International Airport','Telangane','Hydrabad'),
('Sardar Vallabhbhai Patel International Airport','Gujrat','Ahmedabad'),
('Sri Guru Ram Dass Jee International Airport','Punjab','Amritsar');

-- Creating Airline table --

CREATE TABLE AIRLINE
(AIRLINEID VARCHAR(3) NOT NULL,
AL_NAME VARCHAR(50),
PRIMARY KEY(AIRLINEID));
 
 -- Inserting values in Airline table --
 
INSERT INTO AIRLINE (AIRLINEID, AL_NAME) VALUES
('AI','Air India'),
('VA','Vistara'),
('IG','IndiGo'),
('SJ','Spice Jet'),
('AA','Air Asia'),
('GO','Go First');

-- Creating table DEST to connect airlines to their destination -- 

CREATE TABLE DEST
(AIRLINEID VARCHAR(3) NOT NULL,
AP_NAME VARCHAR(100) NOT NULL,
PRIMARY KEY(AIRLINEID, AP_NAME),
FOREIGN KEY(AIRLINEID) REFERENCES AIRLINE(AIRLINEID) ON DELETE CASCADE,
FOREIGN KEY(AP_NAME) REFERENCES AIRPORT(AP_NAME) ON DELETE CASCADE);

-- Inserting data  in airlines and their destination --
INSERT INTO DEST (AIRLINEID, AP_NAME) VALUES
('AI','Chhatrapati Shivaji International Airport'),
('AI','Kempegowda International Airport'),
('VA','Indira Gandhi International Airport'),
('VA','Chhatrapati Shivaji International Airport'),
('IG','Rajiv Gandhi International Airport'),
('IG','Sri Guru Ram Dass Jee International Airport'),
('SJ','Sardar Vallabhbhai Patel International Airport'),
('SJ','Kempegowda International Airport'),
('AA','Sardar Vallabhbhai Patel International Airport'),
('AA','Chhatrapati Shivaji International Airport'),
('GO','Indira Gandhi International Airport'),
('GO','Sardar Vallabhbhai Patel International Airport');

-- creating table add flight info --
truncate FLIGHT;
CREATE TABLE FLIGHT
(FLIGHT_CODE VARCHAR(10) NOT NULL,
SOURCE VARCHAR(3),
DESTINATION VARCHAR(3),
ARRIVAL VARCHAR(10),
DEPARTURE VARCHAR(10),
STATUS VARCHAR(10),
DURATION VARCHAR(30),
FLIGHTTYPE VARCHAR(10),
AIRLINEID VARCHAR(3),
PRIMARY KEY(FLIGHT_CODE),
FOREIGN KEY(AIRLINEID) REFERENCES AIRLINE(AIRLINEID) ON DELETE CASCADE);

-- inserting data in flight info --

INSERT INTO FLIGHT(FLIGHT_CODE, SOURCE, DESTINATION, ARRIVAL, DEPARTURE, STATUS, DURATION, FLIGHTTYPE, AIRLINEID) VALUES
('AI123','DEL','BLR','12:10','18:55','On-time','3hrs','Non-stop','AI'),
('VA123','DEL','BOM','15:10','18:55','On-time','4hrs','Non-stop','VA'),
('IG123','BLR','AMR','23:10','01:55','On-time','3hrs','Non-stop','IG'),
('SJ123','AMR','AHM','22:00','05:54','On-time','7hrs','Non-stop','SJ'),
('AA123','HYD','AHM','14:10','18:25','On-time','4hrs','Non-stop','AA'),
('GO123','BLR','DEL','17:10','19:55','On-time','4hrs','Connecting','GO');


-- creating passenger info table --

CREATE TABLE PASSENGER
(PASSPORTNO VARCHAR(10) NOT NULL,
PNAME VARCHAR(20),
AGE INT,
GEN VARCHAR(1),
PRIMARY KEY(PASSPORTNO));

-- iNSERTING VALUES IN TABLE: PASSENGER--
INSERT INTO PASSENGER(PASSPORTNO,PNAME,AGE,GEN) VALUES
('A1784568','Ramesh Patil',12,'M'),
('A1234568','Chetan Bhuvad',24,'M'),
('B9876541','Anjali Deshmukh',20,'F'),
('C2345698','Suvarna Parab',50,'F'),
('D1002004','Shraddha Salunkhe',78,'F'),
('K9344666','Unnati Walawalkar',20,'F'),
('M9224266','Mansi Kadam',23,'F'),
('I9454666','B. N. Phaniraj',56,'M'),
('C4365798','Sameer Dahadrai',50,'M');

INSERT INTO PASSENGER(PASSPORTNO,PNAME,AGE,GEN) VALUES
('K8965798','Mishita Naik',1,'F');

INSERT INTO PASSENGER(PASSPORTNO,PNAME,AGE,GEN) VALUES
('U9765798','Shanaya Parab',6,'F');

INSERT INTO PASSENGER(PASSPORTNO,PNAME,AGE,GEN) VALUES
('Z4389798','Mihira Sawant',5,'F');

-- CREATING PASSENGER1 TO CONNECT WITH ID

CREATE TABLE PASSENGER1
(PID INT NOT NULL,
PASSPORTNO VARCHAR(10) NOT NULL,
PRIMARY KEY(PID, PASSPORTNO));

-- Insering values in table: PASSENGER1--
INSERT INTO PASSENGER1(PID, PASSPORTNO) VALUES
(1,'A1784568'),
(2,'A1234568'),
(3,'B9876541'),
(4,'C2345698'),
(5,'D1002004'),
(6,'K9344666'),
(7,'M9224266'),
(8,'I9454666'),
(9,'C4365798');

INSERT INTO PASSENGER1(PID, PASSPORTNO) VALUES
(10,'K8965798');

INSERT INTO PASSENGER1(PID, PASSPORTNO) VALUES
(11,'U9765798');

INSERT INTO PASSENGER1(PID, PASSPORTNO) VALUES
(12,'Z4389798');

-- CREATING TABLE TO DETERMINE WHICH PASSENGER IS GOING THROUGH WHICH FLIGHT
truncate PASSENGER3;
DROP TABLE PASSENGER3;
CREATE TABLE PASSENGER3
(PID INT NOT NULL,
FLIGHT_CODE VARCHAR(10),
PRIMARY KEY(PID),
FOREIGN KEY(FLIGHT_CODE) REFERENCES FLIGHT(FLIGHT_CODE) ON DELETE CASCADE);

INSERT INTO PASSENGER3(PID, FLIGHT_CODE) VALUES
(1,'AI123'),
(2,'VA123'),
(3,'IG123'),
(4,'SJ123'),
(5,'AA123'),
(6,'VA123'),
(7,'IG123'),
(8,'AA123'),
(9,'GO123');

INSERT INTO PASSENGER3(PID, FLIGHT_CODE) VALUES
(10,'VA123');

INSERT INTO PASSENGER3(PID, FLIGHT_CODE) VALUES
(11,'IG123');

INSERT INTO PASSENGER3(PID, FLIGHT_CODE) VALUES
(12,'AI123');

-- Creating tickets table --
drop table ticket1;
CREATE TABLE TICKET1
(TICKET_NUMBER INT NOT NULL,
SOURCE VARCHAR(3),
DESTINATION VARCHAR(3),
DATE_OF_BOOKING varchar(10),
DATE_OF_TRAVEL varchar(10),
SEATNO VARCHAR(5),
CLASS VARCHAR(15),
DATE_OF_CANCELLATION varchar(20),
PID INT,
PASSPORTNO VARCHAR(10),
BOOKING_STATUS VARCHAR(20),
FOREIGN KEY(PID, PASSPORTNO) REFERENCES PASSENGER1(PID, PASSPORTNO) ON DELETE CASCADE);

-- INSERTING INTO TABLE: TICKET1--
INSERT INTO TICKET1(TICKET_NUMBER, SOURCE, DESTINATION, DATE_OF_BOOKING, DATE_OF_CANCELLATION, DATE_OF_TRAVEL, SEATNO, CLASS, PID, PASSPORTNO, BOOKING_STATUS) VALUES
(983763,'DEL','BLR','11-NOV-16',null,'15-DEC-16','82A','BUSINESS',1,'A1784568','BOOKING CONFIRMED'),
(983892,'DEL','BOM','11-SEP-16',null,'20-DEC-16','78D','ECONOMY',2,'A1234568','BOOKING CONFIRMED'),
(983452,'BLR','AMR','21-OCT-16',null,'25-DEC-16','93A','BUSINESS',3,'B9876541','BOOKING CONFIRMED'),
(983999,'AMR','AHM','10-NOV-16',null,'12-JAN-17','56C','FIRST-CLASS',4,'C2345698','BOOKING CONFIRMED'),
(902977,'HYD','AHM','01-DEC-16',null,'16-DEC-16','43F','ECONOMY',5,'D1002004','BOOKING CONFIRMED'),
(905667,'DEL','BOM','05-DEC-16',null,'14-DEC-16','56F','ECONOMY',6,'K9344666','BOOKING CONFIRMED'),
(903467,'BLR','AMR','03-DEC-16',null,'19-DEC-16','43F','FIRST-CLASS',7,'M9224266','BOOKING CONFIRMED'),
(906867,'HYD','AHM','04-DEC-16',null,'13-DEC-16','67F','ECONOMY',8,'I9454666','BOOKING CONFIRMED'),
(903477,'BLR','DEL','13-JUN-16',null,'17-DEC-16','89F','BUSINESS',9,'C4365798','BOOKING CONFIRMED');

INSERT INTO TICKET1(TICKET_NUMBER, SOURCE, DESTINATION, DATE_OF_BOOKING, DATE_OF_CANCELLATION, DATE_OF_TRAVEL, SEATNO, CLASS, PID, PASSPORTNO, BOOKING_STATUS) VALUES
(909207,'DEL','BOM','29-JUN-16',null,'15-DEC-16','04F','FIRST-CLASS',10,'K8965798','BOOKING CONFIRMED');

INSERT INTO TICKET1(TICKET_NUMBER, SOURCE, DESTINATION, DATE_OF_BOOKING, DATE_OF_CANCELLATION, DATE_OF_TRAVEL, SEATNO, CLASS, PID, PASSPORTNO, BOOKING_STATUS) VALUES
(903807,'BLR','AMR','23-JUN-16',null,'13-DEC-16','06F','FIRST-CLASS',11,'U9765798','BOOKING CONFIRMED');

INSERT INTO TICKET1(TICKET_NUMBER, SOURCE, DESTINATION, DATE_OF_BOOKING, DATE_OF_CANCELLATION, DATE_OF_TRAVEL, SEATNO, CLASS, PID, PASSPORTNO, BOOKING_STATUS) VALUES
(908407,'DEL','BLR','20-JUN-16',null,'19-DEC-16','25F','FIRST-CLASS',12,'Z4389798','BOOKING CONFIRMED');

-- Creating tickets 2 --
drop table ticket2;
CREATE TABLE TICKET2
(
PASSPORTNO VARCHAR(10),
DATE_OF_BOOKING varchar(10) NOT NULL,
PRICE INT,
REFUND INT,
PRIMARY KEY(PASSPORTNO));

-- INSERTING VALUES INTO TICKET2--
INSERT INTO TICKET2(PASSPORTNO, DATE_OF_BOOKING, PRICE, REFUND) VALUES
('A1784568','11-NOV-16',18000,0),
('A1234568','11-SEP-16',25000,0),
('B9876541','21-OCT-16',20000,0),
('C2345698','10-NOV-16',50000,0),
('D1002004','01-DEC-16',10400,0),
('K9344666','05-DEC-16',18000,0),
('M9224266','03-DEC-16',12500,0),
('I9454666','04-DEC-16',19800,0),
('C4365798','13-JUN-16',39800,0);

INSERT INTO TICKET2(PASSPORTNO, DATE_OF_BOOKING, PRICE, REFUND) VALUES
('K8965798','29-JUN-16',16000,0);

INSERT INTO TICKET2(PASSPORTNO, DATE_OF_BOOKING, PRICE, REFUND) VALUES
('U9765798','23-JUN-16',15000,0);

INSERT INTO TICKET2(PASSPORTNO, DATE_OF_BOOKING, PRICE, REFUND) VALUES
('Z4389798','20-JUN-16',12000,0);

-- Creating ticket table for cancellation -- 
SELECT * FROM TICKET3;
DROP TABLE TICKET3;
TRUNCATE TICKET3;
CREATE TABLE TICKET3
(PASSPORTNO VARCHAR(20),
DATE_OF_CANCELLATION varchar(10) NOT NULL,
BOOKING_STATUS VARCHAR(20),
REFUND INT,
PRIMARY KEY(PASSPORTNO));

-- INSERTING VALUES INTO TABLE: TICKET3--
INSERT INTO TICKET3(PASSPORTNO, DATE_OF_CANCELLATION, BOOKING_STATUS, REFUND) VALUES
('A1784568','10-DEC-16','BOOKING CANCELLED',0);

INSERT INTO TICKET3(PASSPORTNO, DATE_OF_CANCELLATION, BOOKING_STATUS, REFUND) VALUES
('A1234568','16-NOV-16','BOOKING CANCELLED',0);

INSERT INTO TICKET3(PASSPORTNO, DATE_OF_CANCELLATION, BOOKING_STATUS, REFUND) VALUES
('B9876541','01-DEC-16','BOOKING CANCELLED',0);

INSERT INTO TICKET3(PASSPORTNO, DATE_OF_CANCELLATION, BOOKING_STATUS, REFUND) VALUES
('C2345698','10-DEC-16','BOOKING CANCELLED',0);

INSERT INTO TICKET3(PASSPORTNO, DATE_OF_CANCELLATION, BOOKING_STATUS, REFUND) VALUES
('D1002004','06-DEC-16','BOOKING CANCELLED',0);

INSERT INTO TICKET3(PASSPORTNO, DATE_OF_CANCELLATION, BOOKING_STATUS, REFUND) VALUES
('K9344666','10-DEC-16','BOOKING CANCELLED',0);

INSERT INTO TICKET3(PASSPORTNO, DATE_OF_CANCELLATION, BOOKING_STATUS, REFUND) VALUES
('C4365798','09-DEC-16','BOOKING CANCELLED',0);

INSERT INTO TICKET3(PASSPORTNO, DATE_OF_CANCELLATION, BOOKING_STATUS, REFUND) VALUES
('I9454666','04-DEC-16','BOOKING CANCELLED',0);

-- ---
INSERT INTO TICKET3(PASSPORTNO, DATE_OF_CANCELLATION, BOOKING_STATUS, REFUND) VALUES
('K8965798','01-DEC-16','BOOKING CANCELLED',0);


-- CREATING PASSENGER_DATA TABLE TO SUMMERIZE ALL THE USEFULL DATA
DROP TABLE PASSENGER_DATA;
CREATE TABLE PASSENGER_DATA(
TKNUM VARCHAR(20), TKPASSNUM VARCHAR(20), PSNAME VARCHAR(20), PSAGE VARCHAR(20), TKSOUR VARCHAR(20), TKDEST VARCHAR(20), TKDOBKNG VARCHAR(20), TKDOT VARCHAR(20), TKSEAT VARCHAR(20), TKCLASS VARCHAR(20), TKPRICE VARCHAR(20), PSGEN VARCHAR(20), TKDOC VARCHAR(20), BOOKING_STATUS VARCHAR(20), REFUND INT
);